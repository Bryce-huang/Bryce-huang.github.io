<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/blog/crown.png"><link rel="icon" type="image/png" href="/img/blog/crown.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#2f4154"><meta name="description" content="Nothing is so common as the wish to be remarkables"><meta name="author" content="Bryce Huang"><meta name="keywords" content="blog,program,life"><title>Ansibleç®€æ˜æŒ‡åŒ— - Bryce&#39;s Club</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/dracula.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_fmb4a04yx8h.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css"><link rel="stylesheet" href="https://cdn.staticfile.org/gitalk/1.6.2/gitalk.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Bryce's Club" type="application/atom+xml"></head><body><div id="dark" onclick="switchDarkMode()"></div><script>var isNight=18<=(new Date).getHours()||(new Date).getHours()<8;(matchMedia("(prefers-color-scheme: dark)").matches||isNight||"1"===localStorage.getItem("dark"))&&(isNight&&"1"===localStorage.getItem("noDark")||document.body.classList.add("dark")),document.getElementById("dark").innerHTML=document.querySelector("body").classList.contains("dark")?"ğŸŒ™":"ğŸŒ"</script><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>Bryce's Club</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> é¦–é¡µ</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> å½’æ¡£</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> åˆ†ç±»</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> æ ‡ç­¾</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> å‹é“¾</a></li><li class="nav-item"><a class="nav-link" href="/messageboard/"><i class="iconfont icon-speakernotes"></i> ç•™è¨€</a></li><li class="nav-item"><a class="nav-link" href="/features/"><i class="iconfont icon-exp-fill"></i> åŠŸèƒ½</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> å…³äº</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i class="iconfont icon-search"></i>&nbsp;&nbsp;</a></li></ul></div></div></nav><div class="view intro-2" id="background" parallax="true" style="background:url(/img/star-guardian/champion-pajama-group-splash.webp) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="container text-center white-text fadeInUp"><span class="h2" id="subtitle"></span><div class="mt-3 post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2020-05-15 16:33">æ˜ŸæœŸäº”, äº”æœˆ 15æ—¥ 2020, 4:33 ä¸‹åˆ</time></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 3.9k å­— </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 53 åˆ†é’Ÿ</span></div></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5" id="board"><div class="post-content mx-auto" id="post"><article class="markdown-body"><h2 id="Ansibleç®€ä»‹"><a href="#Ansibleç®€ä»‹" class="headerlink" title="Ansibleç®€ä»‹"></a>Ansibleç®€ä»‹</h2><p>æˆ‘æ˜¯åœ¨å­¦ä¹ éƒ¨ç½²<a href="https://docs.okd.io/" target="_blank" rel="noopener">okd</a>ä¸ansibleç›¸é‡çš„ï¼Œæˆ‘ä»æ¥æ²¡æœ‰ç‰¹åœ°å»å­¦ä¹ è¿™ä¹ˆä¸€æ¬¾å·¥å…·ï¼Œåªæ˜¯éœ€è¦çš„æ—¶å€™æŸ¥é˜…ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ï¼ŒansibleçœŸçš„è¶³å¤Ÿç®€å•ï¼Œå¯ä»¥æƒ³ä½¿ç”¨å‘½ä»¤è¡Œä¸€æ ·ä½¿ç”¨ansibleï¼Œå½“ç„¶ansibleä¹Ÿå¯ä»¥åšä¸€äº›ä¸ç®€å•çš„äº‹æƒ…ã€‚<br><a href="https://docs.ansible.com/ansible/latest/index.html" target="_blank" rel="noopener">Ansible</a>æ˜¯ä¸€ç§ITè‡ªåŠ¨åŒ–å·¥å…·ã€‚å®ƒå¯ä»¥é…ç½®ç³»ç»Ÿï¼Œéƒ¨ç½²è½¯ä»¶ä»¥åŠåè°ƒæ›´é«˜çº§çš„ITä»»åŠ¡ï¼Œä¾‹å¦‚è¿ç»­éƒ¨ç½²æˆ–é›¶åœæœºæ»šåŠ¨æ›´æ–°ã€‚Ansibleçš„ä¸»è¦ç›®æ ‡æ˜¯ç®€å•å’Œæ˜“ç”¨ã€‚å®ƒè¿˜éå¸¸å…³æ³¨å®‰å…¨æ€§å’Œå¯é æ€§ï¼Œå…¶ç‰¹ç‚¹æ˜¯æ´»åŠ¨éƒ¨ä»¶æœ€å°‘ï¼Œä½¿ç”¨OpenSSHè¿›è¡Œè¿è¾“ï¼ˆä½¿ç”¨å…¶ä»–è¿è¾“æ–¹å¼å’Œæ‹‰åŠ¨æ¨¡å¼ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆï¼‰ä»¥åŠä¸€ç§å›´ç»•äººå‘˜ï¼ˆå³ä½¿æ˜¯ä¸ç†Ÿæ‚‰çš„äººï¼‰å¯å®¡æ ¸æ€§è®¾è®¡çš„è¯­è¨€ã€‚</p><h2 id="Ansibleæ¦‚å¿µ"><a href="#Ansibleæ¦‚å¿µ" class="headerlink" title="Ansibleæ¦‚å¿µ"></a>Ansibleæ¦‚å¿µ</h2><h3 id="æ§åˆ¶èŠ‚ç‚¹ï¼ˆControl-nodeï¼‰"><a href="#æ§åˆ¶èŠ‚ç‚¹ï¼ˆControl-nodeï¼‰" class="headerlink" title="æ§åˆ¶èŠ‚ç‚¹ï¼ˆControl nodeï¼‰"></a>æ§åˆ¶èŠ‚ç‚¹ï¼ˆControl nodeï¼‰</h3><p>ä»»ä½•è£…æœ‰Ansibleçš„æœºå™¨ã€‚å¯ä»¥ä»ä»»ä½•æ§åˆ¶èŠ‚ç‚¹è°ƒç”¨/usr/bin/ansibleæˆ–æ¥è¿è¡Œå‘½ä»¤å’Œè¿è¡Œplaybook /usr/bin/ansible-playbookã€‚å¯ä»¥å°†ä»»ä½•å®‰è£…äº†Pythonçš„è®¡ç®—æœºç”¨ä½œæ§åˆ¶èŠ‚ç‚¹-ç¬”è®°æœ¬ç”µè„‘ï¼Œå…±äº«å°å¼æœºå’ŒæœåŠ¡å™¨éƒ½å¯ä»¥è¿è¡ŒAnsibleã€‚ä½†æ˜¯ï¼Œä¸èƒ½å°†Windowsè®¡ç®—æœºç”¨ä½œæ§åˆ¶èŠ‚ç‚¹ã€‚æ‚¨å¯ä»¥æœ‰å¤šä¸ªæ§åˆ¶èŠ‚ç‚¹ã€‚</p><h3 id="å—æ§èŠ‚ç‚¹ï¼ˆManaged-nodesï¼‰"><a href="#å—æ§èŠ‚ç‚¹ï¼ˆManaged-nodesï¼‰" class="headerlink" title="å—æ§èŠ‚ç‚¹ï¼ˆManaged nodesï¼‰"></a>å—æ§èŠ‚ç‚¹ï¼ˆManaged nodesï¼‰</h3><p>ä½¿ç”¨Ansibleç®¡ç†çš„ç½‘ç»œè®¾å¤‡ï¼ˆå’Œ/æˆ–æœåŠ¡å™¨ï¼‰ã€‚å—ç®¡èŠ‚ç‚¹æœ‰æ—¶ä¹Ÿç§°ä¸ºâ€œä¸»æœºâ€ã€‚æœªåœ¨å—ç®¡èŠ‚ç‚¹ä¸Šå®‰è£…Ansibleã€‚</p><h3 id="ç®¡ç†æ¸…å•ï¼ˆInventoryï¼‰"><a href="#ç®¡ç†æ¸…å•ï¼ˆInventoryï¼‰" class="headerlink" title="ç®¡ç†æ¸…å•ï¼ˆInventoryï¼‰"></a>ç®¡ç†æ¸…å•ï¼ˆInventoryï¼‰</h3><p>å—æ§èŠ‚ç‚¹çš„åˆ—è¡¨ã€‚æ¸…å•æ–‡ä»¶æœ‰æ—¶ä¹Ÿç§°ä¸ºâ€œä¸»æœºæ–‡ä»¶â€ã€‚æ‚¨çš„æ¸…å•å¯ä»¥ä¸ºæ¯ä¸ªå—ç®¡èŠ‚ç‚¹æŒ‡å®šä¿¡æ¯ï¼Œä¾‹å¦‚IPåœ°å€ã€‚åº“å­˜è¿˜å¯ä»¥ç»„ç»‡å—ç®¡èŠ‚ç‚¹ï¼Œåˆ›å»ºå’ŒåµŒå¥—ç»„ä»¥ä¾¿äºæ‰©å±•ã€‚é»˜è®¤æ˜¯ä½¿ç”¨<code>/etc/ansible/hosts</code> æ–‡ä»¶ä½œä¸ºç®¡ç†æ¸…å•æ–‡ä»¶ã€‚åœ¨è¿è¡Œæ—¶å¯ä»¥é€šè¿‡<code>-i</code> è‡ªå®šä¹‰hostsåœ°å€ã€‚è¯¦ç»†è¯·å‚è€ƒ:<a href="https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#intro-inventory" target="_blank" rel="noopener">ç®¡ç†æ¸…å•</a></p><h3 id="æ¨¡å—ï¼ˆModulesï¼‰"><a href="#æ¨¡å—ï¼ˆModulesï¼‰" class="headerlink" title="æ¨¡å—ï¼ˆModulesï¼‰"></a>æ¨¡å—ï¼ˆModulesï¼‰</h3><p>å°†æ‰§è¡Œä»£ç å•å…ƒAnsibleã€‚ä»ç®¡ç†ç‰¹å®šç±»å‹çš„æ•°æ®åº“ä¸Šçš„ç”¨æˆ·åˆ°ç®¡ç†ç‰¹å®šç±»å‹çš„ç½‘ç»œè®¾å¤‡ä¸Šçš„VLANæ¥å£ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰ç‰¹å®šçš„ç”¨é€”ã€‚æ‚¨å¯ä»¥é€šè¿‡ansibleå‘½ä»¤è°ƒç”¨å•ä¸ªæ¨¡å—ï¼Œä¹Ÿå¯ä»¥åœ¨playbookä¸­è°ƒç”¨å¤šä¸ªä¸åŒçš„æ¨¡å—ã€‚è¯¦ç»†è¯·å‚è€ƒï¼š<a href="https://docs.ansible.com/ansible/latest/modules/modules_by_category.html#modules-by-category" target="_blank" rel="noopener">æ‰€æœ‰æ¨¡å—</a></p><h3 id="ä»»åŠ¡ï¼ˆTasksï¼‰"><a href="#ä»»åŠ¡ï¼ˆTasksï¼‰" class="headerlink" title="ä»»åŠ¡ï¼ˆTasksï¼‰"></a>ä»»åŠ¡ï¼ˆTasksï¼‰</h3><p>Ansibleä¸­çš„è¡ŒåŠ¨å•ä½ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸´æ—¶å‘½ä»¤ä¸€æ¬¡æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚</p><h3 id="PlayBook"><a href="#PlayBook" class="headerlink" title="PlayBook"></a>PlayBook</h3><p>å·²ä¿å­˜ä»»åŠ¡çš„æœ‰åºåˆ—è¡¨ï¼Œå› æ­¤æ‚¨å¯ä»¥æŒ‰æ­¤é¡ºåºé‡å¤è¿è¡Œè¿™äº›ä»»åŠ¡ã€‚å‰§æœ¬å¯ä»¥åŒ…æ‹¬å˜é‡ä»¥åŠä»»åŠ¡ã€‚å‰§æœ¬é‡‡ç”¨YAMLç¼–å†™ï¼Œæ˜“äºé˜…è¯»ï¼Œç¼–å†™ï¼Œå…±äº«å’Œç†è§£ã€‚è¦äº†è§£æœ‰å…³å‰§æœ¬çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_intro.html#about-playbooks" target="_blank" rel="noopener">å…³äºPlaybook</a></p><h2 id="å®‰è£…Ansible"><a href="#å®‰è£…Ansible" class="headerlink" title="å®‰è£…Ansible"></a>å®‰è£…Ansible</h2><p>ansibleçš„å®‰è£…éå¸¸ç®€å•ï¼ŒCentOSä¸‹å®‰è£…ï¼š<code>yum install -y ansible</code>,Ubantuä¸‹å®‰è£…ï¼š <code>sudo apt update &amp;&amp; sudo apt install software-properties-common &amp;&amp; sudo apt-add-repository --yes --update ppa:ansible/ansible &amp;&amp; sudo apt install ansible</code> æ›´å¤šç³»ç»Ÿå®‰è£…ansibleè¯·å‚è€ƒ<a href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html#" target="_blank" rel="noopener">Installing Ansible</a></p><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>ansibleé…ç½®æ–‡ä»¶æœ‰ä¸¤ä¸ª<code>ansible.cfg</code> å’Œ <code>hosts</code>,å‰è€…ä¸ºansibleè½¯ä»¶é…ç½®ï¼Œå¦‚å¸¸è§çš„ç¬¬ä¸€æ¬¡è®¿é—®host_key_checking,è¿æ¥è¶…æ—¶æ—¶é—´ã€‚åè€…ä¸ºæ‰¹é‡æ‰§è¡Œçš„å—æ§æœºé…ç½®å’Œå˜é‡è®¾ç½®ã€‚</p><h4 id="ansible-cfg"><a href="#ansible-cfg" class="headerlink" title="ansible.cfg"></a>ansible.cfg</h4><p>ansible.cfg é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§ï¼š</p><ol><li>ANSIBLE_CONFIG (ç¯å¢ƒå˜é‡é…ç½®)</li><li>ansible.cfg(å½“å‰ç›®å½•ï¼Œå­˜åœ¨é£é™©ï¼Œä¸ä¼šä¸»åŠ¨åŠ è½½)</li><li>~/.ansible.cfg(å½“å‰ç”¨æˆ·ä¸»ç›®å½•)</li><li>/etc/ansible/ansible.cfg</li></ol><p>ansibleä¼šå®‰è£…ä»¥ä¸Šåˆ—è¡¨å¹¶ä½¿ç”¨ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡<code>ansible-config list</code>å’Œ<code>ansible-config dump --only-changed</code>æŸ¥çœ‹ansibleé…ç½®æƒ…å†µ</p><p>å¸¸ç”¨çš„<code>ansible.cfg</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><div class="hljs"><pre><code class="hljs ini"><span class="hljs-section">[defaults]</span>
<span class="hljs-attr">log_path</span> = /var/log/ansible.log

<span class="hljs-attr">forks</span> = <span class="hljs-number">20</span>
<span class="hljs-attr">host_key_checking</span> = <span class="hljs-literal">False</span>
<span class="hljs-attr">retry_files_enabled</span> = <span class="hljs-literal">False</span>
<span class="hljs-attr">deprecation_warnings</span> = <span class="hljs-literal">False</span>
<span class="hljs-attr">nocows</span> = <span class="hljs-literal">True</span>
<span class="hljs-attr">remote_user</span> = root
<span class="hljs-attr">roles_path</span> = roles/
<span class="hljs-attr">gathering</span> = smart
<span class="hljs-attr">fact_caching</span> = jsonfile
<span class="hljs-attr">fact_caching_connection</span> = /etc/ansible/facts
<span class="hljs-attr">fact_caching_timeout</span> = <span class="hljs-number">600</span>
<span class="hljs-attr">callback_whitelist</span> = profile_tasks
<span class="hljs-attr">inventory_ignore_extensions</span> = secrets.py, .pyc, .cfg, .crt, .ini
<span class="hljs-attr">timeout</span> = <span class="hljs-number">30</span>

<span class="hljs-section">[inventory]</span>
<span class="hljs-attr">unparsed_is_failed</span>=<span class="hljs-literal">true</span>

<span class="hljs-section">[ssh_connection]</span>
<span class="hljs-attr">pipelining</span> = <span class="hljs-literal">True</span>
<span class="hljs-attr">ssh_args</span> = -o ControlMaster=auto -o ControlPersist=<span class="hljs-number">600</span>s
<span class="hljs-attr">timeout</span> = <span class="hljs-number">10</span>
<span class="hljs-attr">control_path</span> = %(directory)s/%%h-%%r</code></pre></div><p>ä»¥ä¸Šé…ç½®æ–‡ä»¶ï¼Œä¸»è¦é…ç½®äº†æ—¥å¿—è·¯å¾„ã€è¿œç¨‹ç”¨æˆ·ä¿¡æ¯ã€è¶…æ—¶æ—¶é—´ç­‰ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è€ƒï¼š<a href="https://github.com/ansible/ansible/blob/devel/examples/ansible.cfg" target="_blank" rel="noopener">ansible.cfg example</a>å’Œ<a href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html#ansible-configuration-settings" target="_blank" rel="noopener">ansible configuration</a>ã€‚</p><h4 id="hosts"><a href="#hosts" class="headerlink" title="hosts"></a>hosts</h4><p>ç®¡ç†æ¸…å•(hostæ–‡ä»¶)é»˜è®¤åœ¨<code>/etc/ansible/hosts</code>,å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œ <code>-i &lt;path&gt;</code>å‚æ•°è¿›è¡ŒæŒ‡å®šï¼Œ<code>-i</code>å‚æ•°å¯ä»¥å¤šæ¬¡æŒ‡å®šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œansibleæ”¯æŒå¤šä¸ªhostsæ–‡ä»¶åŒæ—¶ä½¿ç”¨ã€‚hostæ–‡ä»¶æ”¯æŒ<code>ini</code>å’Œ<code>yaml</code>ä¸¤ç§æ ¼å¼ã€‚</p><p>iniæ–‡ä»¶ï¼š</p><div class="hljs"><pre><code class="hljs ini">mail.example.com

<span class="hljs-section">[webservers]</span>
foo.example.com
bar.example.com

<span class="hljs-section">[dbservers]</span>
one.example.com
two.example.com
three.example.com</code></pre></div><p>yamlæ ¼å¼ï¼š</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">all:</span>
  <span class="hljs-attr">hosts:</span>
    <span class="hljs-attr">mail.example.com:</span>
  <span class="hljs-attr">children:</span>
    <span class="hljs-attr">webservers:</span>
      <span class="hljs-attr">hosts:</span>
        <span class="hljs-attr">foo.example.com:</span>
        <span class="hljs-attr">bar.example.com:</span>
        <span class="hljs-attr">two.example.com:</span>
    <span class="hljs-attr">dbservers:</span>
      <span class="hljs-attr">hosts:</span>
        <span class="hljs-attr">one.example.com:</span>
        <span class="hljs-attr">two.example.com:</span>
        <span class="hljs-attr">three.example.com:</span></code></pre></div><p>è¿™ä¸¤ä¸ªæ–‡ä»¶çš„å†…å®¹æ˜¯ç­‰ä»·çš„ï¼Œå½“ä½ éœ€è¦å¤šçº§ç»“æ„æ—¶ï¼Œæ¨èä½¿ç”¨yamlï¼Œå¦åˆ™iniå°†æ›´åŠ æ–¹ä¾¿ã€‚hostæ–‡ä»¶ä¸­å­˜åœ¨2ä¸ªé»˜è®¤ç»„<code>all</code>å’Œ<code>ungrouped</code>ã€‚å‰è€…åŒ…å«äº†æ¯ä¸€ä¸ªä¸»æœºï¼Œåè€…åˆ™æ˜¯é™¤äº†<code>all</code>æ²¡æœ‰åˆ†ç»„çš„ã€‚å¦‚ç¤ºä¾‹ä¸­çš„<code>mail.expample.com</code>,ä¸€ä¸ªhostå¯ä»¥å­˜åœ¨äºå¤šä¸ªç»„é‡Œé¢ï¼Œå¦‚<code>two.example.com:</code></p><p>ansible æ”¯æŒæ·»åŠ ä¸€ä¸ªèŒƒå›´çš„hostï¼š</p><p>åœ¨INIæ–‡ä»¶ä¸­ï¼š</p><div class="hljs"><pre><code class="hljs ini"><span class="hljs-section">[webservers]</span>
www[01:50].example.com</code></pre></div><p>åœ¨yamlæ–‡ä»¶ä¸­ï¼š</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">webservers:</span>
  <span class="hljs-attr">hosts:</span>
    <span class="hljs-string">www[01:50].example.com:</span></code></pre></div><p>è¡¨ç¤º1-50çš„ä¸»æœºï¼Œæ­¤å¤–hostæ–‡ä»¶æ”¯æŒå­—ç¬¦é¡ºåºå¦‚ï¼š</p><div class="hljs"><pre><code class="hljs ini">
<span class="hljs-section">[databases]</span>
db-[a:f].example.com</code></pre></div><p>hostæ–‡ä»¶æ”¯æŒæ·»åŠ å˜é‡ï¼Œå¦‚ï¼š</p><p>åœ¨INIæ–‡ä»¶ä¸­ï¼š</p><div class="hljs"><pre><code class="hljs ini"><span class="hljs-section">[atlanta]</span>
host1 http_port=80 maxRequestsPerChild=808
host2 http_port=303 maxRequestsPerChild=909</code></pre></div><p>åœ¨YAMLæ–‡ä»¶ä¸­ï¼š</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">atlanta:</span>
  <span class="hljs-attr">host1:</span>
    <span class="hljs-attr">http_port:</span> <span class="hljs-number">80</span>
    <span class="hljs-attr">maxRequestsPerChild:</span> <span class="hljs-number">808</span>
  <span class="hljs-attr">host2:</span>
    <span class="hljs-attr">http_port:</span> <span class="hljs-number">303</span>
    <span class="hljs-attr">maxRequestsPerChild:</span> <span class="hljs-number">909</span></code></pre></div><p>å¯¹äºä¸€äº›åƒéæ ‡å‡†çš„sshç«¯å£ï¼Œå¯ä»¥åœ¨hostnameåé¢æ·»åŠ portï¼š</p><div class="hljs"><pre><code class="hljs ini">badwolf.example.com:5309</code></pre></div><p>ä½†æ˜¯ansibleå¯ä»¥é€šè¿‡opensshçš„è¿æ¥å»æ‰¾åˆ°å¹¶ä½¿ç”¨è¿™äº›ç«¯å£ã€‚</p><p>è¿æ¥çš„å˜é‡ä¹Ÿå¯ä»¥é€šè¿‡hostå˜é‡æè¿°ï¼š</p><div class="hljs"><pre><code class="hljs ini">
localhost              ansible_connection=local
other1.example.com     ansible_connection=ssh        ansible_user=myuser
other2.example.com     ansible_connection=ssh        ansible_user=myotheruser</code></pre></div><p>hostæ–‡ä»¶æ”¯æŒåˆ«å</p><p>INIæ–‡ä»¶ï¼š</p><div class="hljs"><pre><code class="hljs ini">jumper ansible_port=5555 ansible_host=192.0.2.50</code></pre></div><p>yamlæ–‡ä»¶</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">hosts:</span>
  <span class="hljs-attr">jumper:</span>
    <span class="hljs-attr">ansible_port:</span> <span class="hljs-number">5555</span>
    <span class="hljs-attr">ansible_host:</span> <span class="hljs-number">192.0</span><span class="hljs-number">.2</span><span class="hljs-number">.50</span></code></pre></div><p>åœ¨å‘½ä»¤è¡Œæˆ–è€…playbookæ–‡ä»¶ä¸­å¯ä»¥é€šè¿‡åˆ«åä½¿ç”¨å¯¹åº”çš„hostï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­æŒ‡å®šäº†ç«¯å£å·ã€‚</p><p>hostæ”¯æŒç»„å˜é‡ï¼Œç›¸å½“äºæ¯ä¸€ä¸ªhostéƒ½ç»§æ‰¿äº†ç»„å˜é‡ï¼š</p><p>INIæ–‡ä»¶ï¼š</p><div class="hljs"><pre><code class="hljs ini"><span class="hljs-section">[atlanta]</span>
host1
host2

<span class="hljs-section">[atlanta:vars]</span>
<span class="hljs-attr">ntp_server</span>=ntp.atlanta.example.com
<span class="hljs-attr">proxy</span>=proxy.atlanta.example.com</code></pre></div><p>YAMLæ–‡ä»¶ï¼š</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">atlanta:</span>
  <span class="hljs-attr">hosts:</span>
    <span class="hljs-attr">host1:</span>
    <span class="hljs-attr">host2:</span>
  <span class="hljs-attr">vars:</span>
    <span class="hljs-attr">ntp_server:</span> <span class="hljs-string">ntp.atlanta.example.com</span>
    <span class="hljs-attr">proxy:</span> <span class="hljs-string">proxy.atlanta.example.com</span></code></pre></div><p>ä¸è¿‡è¿™ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼šä¸€ä¸ªhoståœ¨å¤šä¸ªç»„ï¼Œä¸”å¤šä¸ªç»„éƒ½è®¾ç½®åŒä¸€ä¸ªå˜é‡ã€‚è¿™å°†å¼•èµ·å†²çªï¼Œansibleå°†æŒ‰ç…§å­—ç¬¦é¡ºåºé€‰æ‹©æœ€åä¸€ä¸ªï¼ˆå°½é‡é¿å…è¿™ç§é—®é¢˜å‡ºç°ï¼‰ï¼Œansibleæ”¯æŒé€šè¿‡<code>ansible_group_priority</code>ä¿®æ”¹ä¼˜å…ˆçº§ï¼Œé»˜è®¤å€¼ä¸º1ã€‚å…·ä½“è§„åˆ™å‚è€ƒ <a href="https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#how-we-merge" target="_blank" rel="noopener">rules for merging</a></p><p>æ­¤å¤–ï¼Œhostæ–‡ä»¶æ”¯æŒå¤šé‡ç»„å˜é‡é›†æˆï¼Œé€šè¿‡<code>:children</code>æˆ–<code>children:</code>åˆ†åˆ«åœ¨INIå’ŒYAMLæ¥ä½¿ç”¨ï¼š</p><p>INIæ–‡ä»¶ï¼š</p><div class="hljs"><pre><code class="hljs ini"><span class="hljs-section">[atlanta]</span>
host1
host2

<span class="hljs-section">[raleigh]</span>
host2
host3

<span class="hljs-section">[southeast:children]</span>
atlanta
raleigh

<span class="hljs-section">[southeast:vars]</span>
<span class="hljs-attr">some_server</span>=foo.southeast.example.com
<span class="hljs-attr">halon_system_timeout</span>=<span class="hljs-number">30</span>
<span class="hljs-attr">self_destruct_countdown</span>=<span class="hljs-number">60</span>
<span class="hljs-attr">escape_pods</span>=<span class="hljs-number">2</span>

<span class="hljs-section">[usa:children]</span>
southeast
northeast
southwest
northwest</code></pre></div><p>YAMLæ–‡ä»¶ï¼š</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">all:</span>
  <span class="hljs-attr">children:</span>
    <span class="hljs-attr">usa:</span>
      <span class="hljs-attr">children:</span>
        <span class="hljs-attr">southeast:</span>
          <span class="hljs-attr">children:</span>
            <span class="hljs-attr">atlanta:</span>
              <span class="hljs-attr">hosts:</span>
                <span class="hljs-attr">host1:</span>
                <span class="hljs-attr">host2:</span>
            <span class="hljs-attr">raleigh:</span>
              <span class="hljs-attr">hosts:</span>
                <span class="hljs-attr">host2:</span>
                <span class="hljs-attr">host3:</span>
          <span class="hljs-attr">vars:</span>
            <span class="hljs-attr">some_server:</span> <span class="hljs-string">foo.southeast.example.com</span>
            <span class="hljs-attr">halon_system_timeout:</span> <span class="hljs-number">30</span>
            <span class="hljs-attr">self_destruct_countdown:</span> <span class="hljs-number">60</span>
            <span class="hljs-attr">escape_pods:</span> <span class="hljs-number">2</span>
        <span class="hljs-attr">northeast:</span>
        <span class="hljs-attr">northwest:</span>
        <span class="hljs-attr">southwest:</span></code></pre></div><p>hostsæ–‡ä»¶æ”¯æŒå˜é‡æ–‡ä»¶çš„æ·»åŠ ï¼Œåˆ†åˆ«å¯¹åº”<code>host</code>å˜é‡å’Œ<code>group_vars</code>,hostsçš„å˜é‡æ–‡ä»¶å­˜æ”¾ä½ç½®å¯ä»¥åœ¨<code>/etc/ansible/group_vars/</code>å’Œ<code>/etc/ansible/host_vars/</code>,å¦‚ï¼š</p><div class="hljs"><pre><code class="hljs path">&#x2F;etc&#x2F;ansible&#x2F;group_vars&#x2F;raleigh # can optionally end in &#39;.yml&#39;, &#39;.yaml&#39;, or &#39;.json&#39;
&#x2F;etc&#x2F;ansible&#x2F;group_vars&#x2F;webservers
&#x2F;etc&#x2F;ansible&#x2F;host_vars&#x2F;foosball</code></pre></div><p>åŒæ ·ansibleæ”¯æŒä»¥ç»„åä½œä¸ºç›®å½•:</p><div class="hljs"><pre><code class="hljs code">&#x2F;etc&#x2F;ansible&#x2F;group_vars&#x2F;raleigh&#x2F;db_settings
&#x2F;etc&#x2F;ansible&#x2F;group_vars&#x2F;raleigh&#x2F;cluster_settings</code></pre></div><p>ansibleä¹Ÿæ”¯æŒå¤šä¸ªhostsæ–‡ä»¶åœ¨æŒ‡å®šç›®å½•é‡Œï¼š</p><div class="hljs"><pre><code class="hljs code">inventory&#x2F;
  openstack.yml          # configure inventory plugin to get hosts from Openstack cloud
  dynamic-inventory.py   # add additional hosts with dynamic inventory script
  static-inventory       # add static hosts and groups
  group_vars&#x2F;
    all.yml              # assign variables to all hosts</code></pre></div><p>ç„¶åè¿è¡Œï¼š<code>ansible-playbook example.yml -i inventory</code></p><p>ansible æœ‰å¾ˆå¤šå†…ç½®å˜é‡ï¼Œå¦‚ï¼š sshè¿æ¥å˜é‡ï¼Œdockerï¼Œlocalï¼Œè¯¦è§ï¼š<a href="https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#id17" target="_blank" rel="noopener">inventory parameters</a></p><p>hostsæ–‡ä»¶æ”¯æŒå¾ˆå¤šæ’ä»¶ï¼š<a href="https://docs.ansible.com/ansible/latest/plugins/inventory.html#inventory-plugins" target="_blank" rel="noopener">Inventory Plugins</a></p><p>hostsæ–‡ä»¶åŒæ ·æ”¯æŒåŠ¨æ€åŠŸèƒ½ï¼š<a href="https://docs.ansible.com/ansible/latest/user_guide/intro_dynamic_inventory.html#id3" target="_blank" rel="noopener">dynamic inventory</a></p><h2 id="æ§åˆ¶æ¨¡å¼"><a href="#æ§åˆ¶æ¨¡å¼" class="headerlink" title="æ§åˆ¶æ¨¡å¼"></a>æ§åˆ¶æ¨¡å¼</h2><p>ansible åœ¨è¿è¡Œç›¸å…³ä»»åŠ¡çš„æ—¶å€™ï¼Œå³é€šè¿‡<code>ansible</code>æˆ–è€…åœ¨ç¼–å†™ansible-playbookçš„æ–‡ä»¶ï¼ŒæŒ‡å®šå“ªäº›å—æ§ä¸»æœºéœ€è¦æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹é€šç”¨æ¨¡å¼æŒ‡å®šï¼š</p><table><thead><tr><th style="text-align:center">æè¿°</th><th style="text-align:center">æ¨¡å¼</th><th style="text-align:center">ç›®æ ‡ä¸»æœº</th></tr></thead><tbody><tr><td style="text-align:center">æ‰€æœ‰ä¸»æœº</td><td style="text-align:center">allï¼ˆ*ï¼‰</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">ä¸€ä¸ªä¸»æœº</td><td style="text-align:center">host1</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">å¤šä¸ªä¸»æœº</td><td style="text-align:center">host1:host2(host1,host2)</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">ä¸€ä¸ªåˆ†ç»„</td><td style="text-align:center">ins</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">åˆ†ç»„å¹¶é›†</td><td style="text-align:center">ins:nodes</td><td style="text-align:center">æ‰€æœ‰åœ¨insåŠ ä¸Šæ‰€æœ‰åœ¨nodesçš„ä¸»æœº</td></tr><tr><td style="text-align:center">åˆ†ç»„å·®é›†</td><td style="text-align:center">ins:!nodes</td><td style="text-align:center">æ‰€æœ‰åœ¨insä½†ä¸åœ¨nodesçš„ä¸»æœº</td></tr><tr><td style="text-align:center">åˆ†ç»„äº¤é›†</td><td style="text-align:center">ins:&amp;nodes</td><td style="text-align:center">æ‰€æœ‰åœ¨insä¹Ÿåœ¨nodesçš„ä¸»æœº</td></tr></tbody></table><p>å¯ä»¥åƒè¿™æ ·ï¼š<code>ins:nodes:&amp;infra:!master</code>,è¡¨ç¤ºinså’Œnodeså¹¶ä¸”éƒ½åœ¨infraä¸”ä¸æ˜¯masterçš„hosts<br>å—æ§æ¨¡å¼åŒæ ·æ”¯æŒé€šé…ç¬¦ï¼š</p><div class="hljs"><pre><code class="hljs code">192.0.\*
\*.example.com
\*.com

one*.com:dbservers</code></pre></div><p>åœ¨æ¨¡å¼ä¸­ä½¿ç”¨å˜é‡ï¼Œå¯ä»¥åœ¨ <code>ansible-playbook</code>ä½¿ç”¨<code>-e</code>æ³¨å…¥å˜é‡</p><p><code>webservers:!:&amp;</code></p><p>åœ¨æ¨¡å¼ä¸­ä½¿ç”¨æ•°ç»„è§’æ ‡,æ¯”å¦‚å­˜åœ¨insï¼š</p><div class="hljs"><pre><code class="hljs INI"><span class="hljs-section">[ins]</span>
master
infra
nodes</code></pre></div><p>å¯ä»¥é€šè¿‡æ•°ç»„è§’æ ‡æ¥æŒ‡å®šhostï¼š</p><div class="hljs"><pre><code class="hljs code">ins[0]       # master
ins[-1]      # nodes
ins[0:2]     # ini[0],ins[1]
ins[1:]      #  infra nodes
ins[:3]      # master,infra,nodes</code></pre></div><p>åœ¨æ¨¡å¼ä¸­ä½¿ç”¨æ­£åˆ™åŒ¹é…ï¼Œä»¥<code>~</code>å¼€å¤´</p><p><code>~(web|db).*\.example\.com</code></p><h2 id="ä¸´æ—¶å‘½ä»¤ï¼ˆå‘½ä»¤è¡Œï¼‰"><a href="#ä¸´æ—¶å‘½ä»¤ï¼ˆå‘½ä»¤è¡Œï¼‰" class="headerlink" title="ä¸´æ—¶å‘½ä»¤ï¼ˆå‘½ä»¤è¡Œï¼‰"></a>ä¸´æ—¶å‘½ä»¤ï¼ˆå‘½ä»¤è¡Œï¼‰</h2><p>ansibleæ‹¥æœ‰å¼€ç®±å³ç”¨çš„åŠŸèƒ½ï¼Œåªè¦é…ç½®å¥½äº†ä¸Šé¢ä¸¤ä¸ªæ–‡ä»¶è¿è¡Œå‘½ä»¤è¡Œ<code>ansible all -m ping</code> å³å¯ä»¥æŸ¥çœ‹å„å—æ§ä¸»æœºçš„çŠ¶æ€ã€‚</p><p>ä¸´æ—¶å‘½ä»¤ç”¨äºå¿«é€Ÿæ‰¹é‡æ‰§è¡Œå‘½ä»¤:</p><div class="hljs"><pre><code class="hljs shell">ansible [æ¨¡å¼] -m [æ¨¡å—] -a "[æ¨¡å—å‚æ•°]"</code></pre></div><p>ansibleåœ¨ä¸ä½¿ç”¨<code>-m</code> æŒ‡å®šæ¨¡å—æ—¶ï¼Œé»˜è®¤ä½¿ç”¨commandæ¨¡å—ï¼Œé»˜è®¤æƒ…å†µä¸‹ansibleä½¿ç”¨5ä¸ªå¹¶å‘è¿›ç¨‹ï¼Œå½“ä½ æƒ³æŒ‡å®šè¿›ç¨‹æ•°æ—¶å¯ä»¥é€šè¿‡<code>-f</code> ,é€šè¿‡<code>-u</code> æŒ‡å®šæ‰§è¡Œç”¨æˆ·ï¼Œé€šè¿‡<code>--become</code>æå‡ç”¨æˆ·æƒé™:</p><div class="hljs"><pre><code class="hljs sh">
ansible atlanta -a <span class="hljs-string">"/sbin/reboot"</span> -f 10 -u username --become ã€‚</code></pre></div><h3 id="å¸¸è§æ¨¡å—"><a href="#å¸¸è§æ¨¡å—" class="headerlink" title="å¸¸è§æ¨¡å—"></a>å¸¸è§æ¨¡å—</h3><h4 id="ç®¡ç†æ–‡ä»¶"><a href="#ç®¡ç†æ–‡ä»¶" class="headerlink" title="ç®¡ç†æ–‡ä»¶"></a>ç®¡ç†æ–‡ä»¶</h4><ol><li><p>å¤åˆ¶æ–‡ä»¶ï¼š<code>ansible ins -m copy -a &quot;src=/etc/hosts dest=/tmp/hosts`</code></p></li><li><p>åˆ›å»ºæ–‡ä»¶ï¼š <code>ansible ins -m file -a &quot;dest=/srv/foo/b.txt mode=600 owner=bryce group=bryce&quot;</code></p></li><li><p>åˆ›å»ºç›®å½•ï¼š<code>ansible ins -m file -a &quot;dest=/path/to/c mode=755 owner=bryce group=bryce state=directory&quot;</code></p></li><li><p>åˆ é™¤æ–‡ä»¶ï¼š<code>ansible ins -m file -a &quot;dest=/path/to/c state=absent&quot;</code></p></li></ol><h4 id="ç®¡ç†åŒ…"><a href="#ç®¡ç†åŒ…" class="headerlink" title="ç®¡ç†åŒ…"></a>ç®¡ç†åŒ…</h4><ol><li>å®‰è£…åŒ…ï¼š<code>ansible ins -m yum -a &quot;name=java-1.8.0-openjdk state=present&quot;</code></li><li>ç¡®ä¿åŒ…ä¸ºæœ€æ–°ï¼š<code>ansible ins -m yum -a &quot;name=java state=latest&quot;</code></li><li>ç¡®ä¿æœªå®‰è£…åŒ…ï¼š<code>ansible webservers -m yum -a &quot;name=java state=absent&quot;</code></li></ol><h4 id="ç®¡ç†ç”¨æˆ·å’Œç»„"><a href="#ç®¡ç†ç”¨æˆ·å’Œç»„" class="headerlink" title="ç®¡ç†ç”¨æˆ·å’Œç»„"></a>ç®¡ç†ç”¨æˆ·å’Œç»„</h4><ol><li>åˆ›å»ºç”¨æˆ·ï¼š<code>ansible all -m user -a &quot;name=bryce password=&lt;crypted password here&gt;&quot;</code></li><li>åˆ é™¤ç”¨æˆ·ï¼š<code>ansible all -m user -a &quot;name=bryce state=absent&quot;</code></li></ol><h4 id="ç®¡ç†æœåŠ¡"><a href="#ç®¡ç†æœåŠ¡" class="headerlink" title="ç®¡ç†æœåŠ¡"></a>ç®¡ç†æœåŠ¡</h4><ol><li>å¯åŠ¨æœåŠ¡ï¼š<code>ansible ins -m service -a &quot;name=httpd state=started&quot;</code></li><li>åœæ­¢æœåŠ¡ï¼š <code>ansible ins -m service -a &quot;name=httpd state=stopped&quot;</code></li></ol><h4 id="æ”¶é›†ä¿¡æ¯"><a href="#æ”¶é›†ä¿¡æ¯" class="headerlink" title="æ”¶é›†ä¿¡æ¯"></a>æ”¶é›†ä¿¡æ¯</h4><p><code>ansible all -m setup</code></p><h2 id="Playbooks"><a href="#Playbooks" class="headerlink" title="Playbooks"></a>Playbooks</h2><p>playbooksæ˜¯ansibleçš„é…ç½®ï¼Œéƒ¨ç½²å’Œç¼–æ’è¯­è¨€ã€‚çœŸæ­£å…·æœ‰ç”Ÿäº§åŠ›çš„æ¬ç –å·¥å…·ã€‚</p><p>åœ¨ä»‹ç»playbookä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸€ä¸ªplaybookçš„æ–‡æ¡£ç»“æ„</p><p>è¿™æ˜¯æˆ‘ä¸€ä¸ªå®‰è£…ElasticSearchçš„ç®€å•ä¾‹å­ï¼š</p><div class="hljs"><pre><code class="hljs tree">.
â”œâ”€â”€ elasticsearch.yml
â”œâ”€â”€ roles
â”‚Â Â  â”œâ”€â”€ after_install
â”‚Â Â  â”‚Â Â  â””â”€â”€ tasks
â”‚Â Â  â”‚Â Â      â””â”€â”€ main.yml
â”‚Â Â  â”œâ”€â”€ certs
â”‚Â Â  â”‚Â Â  â””â”€â”€ tasks
â”‚Â Â  â”‚Â Â      â””â”€â”€ main.yml
â”‚Â Â  â”œâ”€â”€ elasticsearch
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ tasks
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ config_elasticsearch.yml
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ install_elasticsearch.yml
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ main.yml
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ redhat.yml
â”‚Â Â  â”‚Â Â  â””â”€â”€ templates
â”‚Â Â  â”‚Â Â      â”œâ”€â”€ elasticsearch
â”‚Â Â  â”‚Â Â      â”œâ”€â”€ elasticsearch.yml
â”‚Â Â  â”‚Â Â      â””â”€â”€ jvm.options
â”‚Â Â  â””â”€â”€ user
â”‚Â Â      â””â”€â”€ tasks
â”‚Â Â          â””â”€â”€ main.yml
â””â”€â”€ vars
    â””â”€â”€ elasticsearch.yml</code></pre></div><p>åŒ…å«äº†è¿è¡Œä¸»æ–‡ä»¶elasticsearch.ymlã€rolesæ–‡ä»¶å¤¹ã€varså˜é‡æ–‡ä»¶å¤¹ã€‚rolesæ–‡ä»¶åŒ…å«äº†å¤šä¸ªæ¨¡å—çš„ä»»åŠ¡ï¼Œå…¶ä¸­elasticsearchç”¨åˆ°äº†æ¨¡æ¿ã€‚</p><h3 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h3><h4 id="hostså’Œusers"><a href="#hostså’Œusers" class="headerlink" title="hostså’Œusers"></a>hostså’Œusers</h4><p>æ¯ä¸€ä¸ªplaybookéƒ½éœ€è¦å£°æ˜hostså’Œuser,ç”¨æˆ·å¯ä»¥åœ¨æ¯ä¸€ä¸ªtaskä¸ŠæŒ‡å®šä¹Ÿå¯ä»¥åœ¨å…¨å±€æŒ‡å®šã€‚<code>become</code>ç”¨äºæå‡æƒé™</p><div class="hljs"><pre><code class="hljs yml"><span class="hljs-meta">---</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">webservers</span>
  <span class="hljs-attr">remote_user:</span> <span class="hljs-string">root</span>
  <span class="hljs-attr">tasks:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">test</span> <span class="hljs-string">connection</span>
      <span class="hljs-attr">ping:</span>
      <span class="hljs-attr">remote_user:</span> <span class="hljs-string">yourname</span>
      <span class="hljs-attr">become:</span> <span class="hljs-literal">yes</span></code></pre></div><h4 id="tasksåˆ—è¡¨"><a href="#tasksåˆ—è¡¨" class="headerlink" title="tasksåˆ—è¡¨"></a>tasksåˆ—è¡¨</h4><p>åœ¨ä¸Šé¢çš„<code>tasks:</code>è¡¨ç¤ºä¸€ç³»åˆ—éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¦‚ï¼š</p><div class="hljs"><pre><code class="hljs yml"><span class="hljs-attr">tasks:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">enable</span> <span class="hljs-string">selinux</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">/sbin/setenforce</span> <span class="hljs-number">1</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">run</span> <span class="hljs-string">this</span> <span class="hljs-string">command</span> <span class="hljs-string">and</span> <span class="hljs-string">ignore</span> <span class="hljs-string">the</span> <span class="hljs-string">result</span>
    <span class="hljs-attr">shell:</span> <span class="hljs-string">/usr/bin/somecommand</span>
    <span class="hljs-attr">ignore_errors:</span> <span class="hljs-literal">True</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Copy</span> <span class="hljs-string">ansible</span> <span class="hljs-string">inventory</span> <span class="hljs-string">file</span> <span class="hljs-string">to</span> <span class="hljs-string">client</span>
    <span class="hljs-attr">copy:</span> <span class="hljs-string">src=/etc/ansible/hosts</span> <span class="hljs-string">dest=/etc/ansible/hosts</span>
            <span class="hljs-string">owner=root</span> <span class="hljs-string">group=root</span> <span class="hljs-string">mode=0644</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">create</span> <span class="hljs-string">a</span> <span class="hljs-string">foo.conf</span> <span class="hljs-string">file</span>
    <span class="hljs-attr">template:</span>
    <span class="hljs-attr">src:</span> <span class="hljs-string">templates/foo.j2</span>
    <span class="hljs-attr">dest:</span> <span class="hljs-string">/etc/foo.conf</span></code></pre></div><h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h3><p>åœ¨playbookä»»ä½•åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªèŠ±æ‹¬å·<code>{{}}</code>æ³¨å…¥å˜é‡ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„yamlè¯­æ³•é™·é˜±ï¼Œåœ¨yamlä½¿ç”¨å˜é‡æ—¶ï¼Œéœ€è¦å°†å˜é‡æ‰€åœ¨ä½ç½®è¿ç»­å­—ç¬¦ç”¨<code>&quot;&quot;</code>åŒ…è£¹ã€‚</p><h4 id="å˜é‡çš„å®šä¹‰"><a href="#å˜é‡çš„å®šä¹‰" class="headerlink" title="å˜é‡çš„å®šä¹‰"></a>å˜é‡çš„å®šä¹‰</h4><p>å˜é‡å¯ä»¥å®šä¹‰åœ¨hostsæ–‡ä»¶ä¸­å®šä¹‰åœ¨playbookä¸­ï¼Œä¹Ÿå¯ä»¥å¼•ç”¨å˜é‡æ–‡ä»¶ï¼š</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">ins</span>
  <span class="hljs-attr">vars:</span>
    <span class="hljs-attr">http_port:</span> <span class="hljs-number">80</span>
  <span class="hljs-attr">vars_files:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">/vars/external_vars.yml</span></code></pre></div><p>ä¹Ÿå¯ä»¥åœ¨ä»»åŠ¡ä¸­æ³¨å†Œå˜é‡ï¼š</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">hosts:</span> <span class="hljs-string">ins</span>

  <span class="hljs-attr">tasks:</span>

     <span class="hljs-bullet">-</span> <span class="hljs-attr">shell:</span> <span class="hljs-string">/usr/bin/foo</span>
       <span class="hljs-attr">register:</span> <span class="hljs-string">foo_result</span>
       <span class="hljs-attr">ignore_errors:</span> <span class="hljs-literal">True</span>

     <span class="hljs-bullet">-</span> <span class="hljs-attr">shell:</span> <span class="hljs-string">/usr/bin/bar</span>
       <span class="hljs-attr">when:</span> <span class="hljs-string">foo_result.rc</span> <span class="hljs-string">==</span> <span class="hljs-number">5</span></code></pre></div><p>ansibleå…³é”®å­—ä¸èƒ½å®šä¹‰ä¸ºå˜é‡ï¼Œå…³é”®å­—ï¼š</p><div class="hljs"><pre><code class="hljs code">add, append, as_integer_ratio, bit_length, capitalize, center, clear, conjugate, copy, count, decode, denominator, difference, difference_update, discard, encode, endswith, expandtabs, extend, find, format, fromhex, fromkeys, get, has_key, hex, imag, index, insert, intersection, intersection_update, isalnum, isalpha, isdecimal, isdigit, isdisjoint, is_integer, islower, isnumeric, isspace, issubset, issuperset, istitle, isupper, items, iteritems, iterkeys, itervalues, join, keys, ljust, lower, lstrip, numerator, partition, pop, popitem, real, remove, replace, reverse, rfind, rindex, rjust, rpartition, rsplit, rstrip, setdefault, sort, split, splitlines, startswith, strip, swapcase, symmetric_difference, symmetric_difference_update, title, translate, union, update, upper, values, viewitems, viewkeys, viewvalues, zfill</code></pre></div><h4 id="ç³»ç»Ÿå˜é‡"><a href="#ç³»ç»Ÿå˜é‡" class="headerlink" title="ç³»ç»Ÿå˜é‡"></a>ç³»ç»Ÿå˜é‡</h4><p>ansibleæœ‰ä¸€äº›å†…ç½®çš„å˜é‡<br><code></code></p><ol><li><p><code>ansible_facts</code>å¯ä»¥é€šè¿‡<code>ansible hostname -m setup</code> æŸ¥çœ‹ï¼Œå¼•ç”¨<code>{{ ansible_facts['devices']['xvda']['model'] }}</code></p></li><li><p><code>hostvars</code> è¿è¡Œçš„ä¸»æœºå˜é‡</p></li><li><code>groups</code> æ˜¯hostsä¸­æ‰€æœ‰ç»„ï¼ˆå’Œä¸»æœºï¼‰çš„åˆ—è¡¨ã€‚è¿™å¯ç”¨äºæšä¸¾ç»„ä¸­çš„æ‰€æœ‰ä¸»æœºã€‚</li><li><code>group_names</code> æ˜¯å½“å‰ä¸»æœºæ‰€åœ¨çš„æ‰€æœ‰ç»„çš„åˆ—è¡¨ï¼ˆæ•°ç»„ï¼‰ã€‚</li><li><code>inventory_hostname</code> Ansibleçš„hostsæ–‡ä»¶ä¸­é…ç½®çš„ä¸»æœºåçš„åç§°</li></ol><h3 id="æ¨¡æ¿"><a href="#æ¨¡æ¿" class="headerlink" title="æ¨¡æ¿"></a>æ¨¡æ¿</h3><p>ansibleçš„æ¨¡æ¿ä½¿ç”¨çš„æ˜¯Jinja2ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ<a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_templating.html" target="_blank" rel="noopener">æ¨¡æ¿ï¼ˆJinja2ï¼‰</a></p><p>ä½¿ç”¨äº†æ¨¡æ¿å³å¯ä»¥ï¼Œåœ¨ä½¿ç”¨templateæ¨¡å—æ—¶ï¼Œæ¸²æŸ“æ¨¡æ¿æ–‡ä»¶ã€‚ä½¿å¾—æ¨¡æ¿æ–‡ä»¶ç¬¦åˆè‡ªå·±çš„è¦æ±‚</p><h4 id="å¸¸è§çš„è¯­æ³•"><a href="#å¸¸è§çš„è¯­æ³•" class="headerlink" title="å¸¸è§çš„è¯­æ³•"></a>å¸¸è§çš„è¯­æ³•</h4><p>å¾ªç¯ï¼š</p><div class="hljs"><pre><code class="hljs jinja2">[&#123;% for host in groups[elasticsearch_hosts] %&#125;&#39;&#123;&#123; host &#125;&#125;&#39;&#123;% if not loop.last %&#125;,&#123;% endif %&#125;&#123;% endfor %&#125;]</code></pre></div><p>åˆ¤æ–­ï¼š</p><div class="hljs"><pre><code class="hljs jinja2">
&#123;% if  ip  &#x3D;&#x3D; inventory_hostname %&#125;
echo &#123;&#123; loop.index - 1 &#125;&#125; &gt; &#123;&#123;install_dir&#125;&#125;&#x2F;&#123;&#123;data_dir&#125;&#125;&#x2F;myid
&#123;% endif %&#125;</code></pre></div><p>åŠ å‡ä¹˜é™¤ï¼š</p><div class="hljs"><pre><code class="hljs jinja2">&#123;&#123;(groups[elasticsearch_hosts] | length)&#x2F;&#x2F;2+1  &#125;&#125; # è·å–é•¿åº¦é™¤2åŠ 1</code></pre></div><h3 id="æ¡ä»¶æ‰§è¡Œ"><a href="#æ¡ä»¶æ‰§è¡Œ" class="headerlink" title="æ¡ä»¶æ‰§è¡Œ"></a>æ¡ä»¶æ‰§è¡Œ</h3><p>æ¡ä»¶æ‰§è¡Œå¯ä»¥åœ¨tasksä¸Šä½¿ç”¨<code>when</code>:</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">tasks:</span>
 <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"shut down CentOS 6 and Debian 7 systems"</span>
   <span class="hljs-attr">command:</span> <span class="hljs-string">/sbin/shutdown</span> <span class="hljs-string">-t</span> <span class="hljs-string">now</span>
   <span class="hljs-attr">when:</span> <span class="hljs-string">(ansible_facts['distribution']</span> <span class="hljs-string">==</span> <span class="hljs-string">"CentOS"</span> <span class="hljs-string">and</span> <span class="hljs-string">ansible_facts['distribution_major_version']</span> <span class="hljs-string">==</span> <span class="hljs-string">"6"</span><span class="hljs-string">)</span> <span class="hljs-string">or</span>
         <span class="hljs-string">(ansible_facts['distribution']</span> <span class="hljs-string">==</span> <span class="hljs-string">"Debian"</span> <span class="hljs-string">and</span> <span class="hljs-string">ansible_facts['distribution_major_version']</span> <span class="hljs-string">==</span> <span class="hljs-string">"7"</span><span class="hljs-string">)</span></code></pre></div><p>when æ”¯æŒå¤šä¸ªå…³é”®å­—<code>in</code> <code>or</code> <code>==</code> <code>and</code> <code>is not defined</code> <code>!=</code></p><h3 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h3><p>ç”¨äºå¤šæ¬¡é‡å¤æ‰§è¡Œä»»åŠ¡</p><p>ç®€å•å¾ªç¯åˆ—è¡¨ï¼š</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">add</span> <span class="hljs-string">several</span> <span class="hljs-string">users</span>
  <span class="hljs-attr">user:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">"<span class="hljs-template-variable">&#123;&#123; item.name &#125;&#125;</span>"</span>
    <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>
    <span class="hljs-attr">groups:</span> <span class="hljs-string">"<span class="hljs-template-variable">&#123;&#123; item.groups &#125;&#125;</span>"</span>
  <span class="hljs-attr">loop:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">&#123;</span> <span class="hljs-attr">name:</span> <span class="hljs-string">'testuser1'</span><span class="hljs-string">,</span> <span class="hljs-attr">groups:</span> <span class="hljs-string">'wheel'</span> <span class="hljs-string">&#125;</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">&#123;</span> <span class="hljs-attr">name:</span> <span class="hljs-string">'testuser2'</span><span class="hljs-string">,</span> <span class="hljs-attr">groups:</span> <span class="hljs-string">'root'</span> <span class="hljs-string">&#125;</span>
  <span class="hljs-comment"># æˆ–è€… loop: '&#123;&#123;vars&#125;&#125;'</span></code></pre></div><p>ä»»åŠ¡é‡è¯•ï¼š</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">shell:</span> <span class="hljs-string">/usr/bin/foo</span>
  <span class="hljs-attr">register:</span> <span class="hljs-string">result</span>
  <span class="hljs-attr">until:</span> <span class="hljs-string">result.stdout.find("all</span> <span class="hljs-string">systems</span> <span class="hljs-string">go")</span> <span class="hljs-string">!=</span> <span class="hljs-number">-1</span>
  <span class="hljs-attr">retries:</span> <span class="hljs-number">5</span>
  <span class="hljs-attr">delay:</span> <span class="hljs-number">10</span></code></pre></div><p>è¯¦æƒ…å‚è€ƒï¼š<a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_loops.html" target="_blank" rel="noopener">loop</a></p><h3 id="é˜»å¡å—"><a href="#é˜»å¡å—" class="headerlink" title="é˜»å¡å—"></a>é˜»å¡å—</h3><p>å—å…è®¸å¯¹ä»»åŠ¡è¿›è¡Œé€»è¾‘åˆ†ç»„ä»¥åŠè¿›è¡Œä¸­çš„é”™è¯¯å¤„ç†ã€‚æ‚¨å¯ä»¥åº”ç”¨äºå•ä¸ªä»»åŠ¡çš„å¤§å¤šæ•°å†…å®¹ï¼ˆå¾ªç¯é™¤å¤–ï¼‰éƒ½å¯ä»¥åº”ç”¨äºå—çº§ï¼Œè¿™ä¹Ÿä½¿è®¾ç½®ä»»åŠ¡é€šç”¨çš„æ•°æ®æˆ–æŒ‡ä»¤å˜å¾—æ›´åŠ å®¹æ˜“ã€‚è¿™å¹¶ä¸æ„å‘³ç€è¯¥æŒ‡ä»¤ä¼šå½±å“å—æœ¬èº«ï¼Œè€Œæ˜¯è¢«å—æ‰€åŒ…å«çš„ä»»åŠ¡ç»§æ‰¿ã€‚å³ï¼Œä½•æ—¶å°†åº”ç”¨äºä»»åŠ¡ï¼Œè€Œä¸æ˜¯å—æœ¬èº«.</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">tasks:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install,</span> <span class="hljs-string">configure,</span> <span class="hljs-string">and</span> <span class="hljs-string">start</span> <span class="hljs-string">Apache</span>
    <span class="hljs-attr">block:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">install</span> <span class="hljs-string">httpd</span> <span class="hljs-string">and</span> <span class="hljs-string">memcached</span>
        <span class="hljs-attr">yum:</span>
          <span class="hljs-attr">name:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">httpd</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">memcached</span>
          <span class="hljs-attr">state:</span> <span class="hljs-string">present</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">apply</span> <span class="hljs-string">the</span> <span class="hljs-string">foo</span> <span class="hljs-string">config</span> <span class="hljs-string">template</span>
        <span class="hljs-attr">template:</span>
          <span class="hljs-attr">src:</span> <span class="hljs-string">templates/src.j2</span>
          <span class="hljs-attr">dest:</span> <span class="hljs-string">/etc/foo.conf</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">start</span> <span class="hljs-string">service</span> <span class="hljs-string">bar</span> <span class="hljs-string">and</span> <span class="hljs-string">enable</span> <span class="hljs-string">it</span>
        <span class="hljs-attr">service:</span>
          <span class="hljs-attr">name:</span> <span class="hljs-string">bar</span>
          <span class="hljs-attr">state:</span> <span class="hljs-string">started</span>
          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">True</span>
    <span class="hljs-attr">when:</span> <span class="hljs-string">ansible_facts['distribution']</span> <span class="hljs-string">==</span> <span class="hljs-string">'CentOS'</span>
    <span class="hljs-attr">become:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">become_user:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">ignore_errors:</span> <span class="hljs-literal">yes</span></code></pre></div><h3 id="å¸¸ç”¨æŠ€å·§åŠæ¨¡å—"><a href="#å¸¸ç”¨æŠ€å·§åŠæ¨¡å—" class="headerlink" title="å¸¸ç”¨æŠ€å·§åŠæ¨¡å—"></a>å¸¸ç”¨æŠ€å·§åŠæ¨¡å—</h3><p><a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html" target="_blank" rel="noopener">ansible-playbookçš„æœ€ä½³å®è·µ</a></p><p>tasksæ”¯æŒå¾ˆå¤šæ¨¡å—å¦‚<code>command</code>ã€<code>shell</code>ã€<code>copy</code>ã€<code>template</code> ç­‰<br>tasks è¿˜æœ‰ä¸€ä¸ªç®€å•çš„å†™æ³•ï¼š<code>action: template src=templates/foo.j2 dest=/etc/foo.conf</code></p><p>æ‰§è¡Œplaybookï¼š<code>ansible-playbook site.yml --limit datacenter2</code></p><h2 id="å‘½ä»¤è¡Œå·¥å…·"><a href="#å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="å‘½ä»¤è¡Œå·¥å…·"></a>å‘½ä»¤è¡Œå·¥å…·</h2><p>ansible æ‹¥æœ‰å¤šä¸ªå‘½ä»¤è¡Œå·¥å…·å…¶ä¸­åŒ…æ‹¬<code>ansible</code>å’Œ<code>ansible-playbook</code>ã€‚</p><h3 id="ansible"><a href="#ansible" class="headerlink" title="ansible"></a>ansible</h3><p>ansibleå‚æ•°ï¼š</p><div class="hljs"><pre><code class="hljs code">usage: ansible [-h] [--version] [-v] [-b] [--become-method BECOME_METHOD]
            [--become-user BECOME_USER] [-K] [-i INVENTORY] [--list-hosts]
            [-l SUBSET] [-P POLL_INTERVAL] [-B SECONDS] [-o] [-t TREE] [-k]
            [--private-key PRIVATE_KEY_FILE] [-u REMOTE_USER]
            [-c CONNECTION] [-T TIMEOUT]
            [--ssh-common-args SSH_COMMON_ARGS]
            [--sftp-extra-args SFTP_EXTRA_ARGS]
            [--scp-extra-args SCP_EXTRA_ARGS]
            [--ssh-extra-args SSH_EXTRA_ARGS] [-C] [--syntax-check] [-D]
            [-e EXTRA_VARS] [--vault-id VAULT_IDS]
            [--ask-vault-pass | --vault-password-file VAULT_PASSWORD_FILES]
            [-f FORKS] [-M MODULE_PATH] [--playbook-dir BASEDIR]
            [-a MODULE_ARGS] [-m MODULE_NAME]
            pattern</code></pre></div><p>è¯¦ç»†ä¿¡æ¯ï¼š<a href="https://docs.ansible.com/ansible/latest/cli/ansible.html#id4" target="_blank" rel="noopener">ansible å¸¸ç”¨é€‰é¡¹</a></p><h3 id="ansible-config"><a href="#ansible-config" class="headerlink" title="ansible-config"></a>ansible-config</h3><p>è¯¦ç»†ä¿¡æ¯ï¼š<a href="https://docs.ansible.com/ansible/latest/cli/ansible-config.html" target="_blank" rel="noopener">ansible-config</a></p><h3 id="ansible-console"><a href="#ansible-console" class="headerlink" title="ansible-console"></a>ansible-console</h3><p>è¯¦ç»†ä¿¡æ¯ï¼š<a href="https://docs.ansible.com/ansible/latest/cli/ansible-console.html" target="_blank" rel="noopener">ansible-console</a></p><h3 id="ansible-doc"><a href="#ansible-doc" class="headerlink" title="ansible-doc"></a>ansible-doc</h3><p>è¯¦ç»†ä¿¡æ¯ï¼š<a href="https://docs.ansible.com/ansible/latest/cli/ansible-doc.html" target="_blank" rel="noopener">ansible-doc</a></p><h3 id="ansible-galaxy"><a href="#ansible-galaxy" class="headerlink" title="ansible-galaxy"></a>ansible-galaxy</h3><p>ç”¨äºç®¡ç†å…±äº«åº“<br>è¯¦ç»†ä¿¡æ¯ï¼š<a href="https://docs.ansible.com/ansible/latest/cli/ansible-galaxy.html" target="_blank" rel="noopener">ansible-galaxy</a></p><h3 id="ansible-inventory"><a href="#ansible-inventory" class="headerlink" title="ansible-inventory"></a>ansible-inventory</h3><p>ç”¨äºç®¡ç†hostsæ–‡ä»¶<br>è¯¦ç»†ä¿¡æ¯ï¼š<a href="https://docs.ansible.com/ansible/latest/cli/ansible-inventory.html" target="_blank" rel="noopener">ansible-inventory</a></p><h3 id="ansible-playbook"><a href="#ansible-playbook" class="headerlink" title="ansible-playbook"></a>ansible-playbook</h3><p>ç”¨äºè¿è¡Œansible-playbookç›¸å…³æ–‡ä»¶</p><p>å¸¸ç”¨å‚æ•°ï¼š</p><div class="hljs"><pre><code class="hljs shell">usage: ansible-playbook [-h] [--version] [-v] [-k]
                     [--private-key PRIVATE_KEY_FILE] [-u REMOTE_USER]
                     [-c CONNECTION] [-T TIMEOUT]
                     [--ssh-common-args SSH_COMMON_ARGS]
                     [--sftp-extra-args SFTP_EXTRA_ARGS]
                     [--scp-extra-args SCP_EXTRA_ARGS]
                     [--ssh-extra-args SSH_EXTRA_ARGS] [--force-handlers]
                     [--flush-cache] [-b] [--become-method BECOME_METHOD]
                     [--become-user BECOME_USER] [-K] [-t TAGS]
                     [--skip-tags SKIP_TAGS] [-C] [--syntax-check] [-D]
                     [-i INVENTORY] [--list-hosts] [-l SUBSET]
                     [-e EXTRA_VARS] [--vault-id VAULT_IDS]
                     [--ask-vault-pass | --vault-password-file VAULT_PASSWORD_FILES]
                     [-f FORKS] [-M MODULE_PATH] [--list-tasks]
                     [--list-tags] [--step] [--start-at-task START_AT_TASK]
                     playbook [playbook ...]</code></pre></div><p>è¯¦ç»†ä¿¡æ¯ï¼š<a href="https://docs.ansible.com/ansible/latest/cli/ansible-playbook.html" target="_blank" rel="noopener">ansible-playbook</a></p><h3 id="ansible-pull"><a href="#ansible-pull" class="headerlink" title="ansible-pull"></a>ansible-pull</h3><p>å»ºç«‹è¿œç¨‹å‰¯æœ¬<br>è¯¦ç»†ä¿¡æ¯ï¼š<a href="https://docs.ansible.com/ansible/latest/cli/ansible-pull.html" target="_blank" rel="noopener">ansible-pull</a></p><h3 id="ansible-vault"><a href="#ansible-vault" class="headerlink" title="ansible-vault"></a>ansible-vault</h3><p>åŠ å¯†ansibleæ–‡ä»¶<br>è¯¦ç»†ä¿¡æ¯ï¼š<a href="https://docs.ansible.com/ansible/latest/cli/ansible-vault.html" target="_blank" rel="noopener">ansible-vault</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ç®€å•ä»‹ç»äº†ansibleçš„æ¦‚å¿µï¼Œä½¿ç”¨æ–¹æ³•ä»¥åŠç›¸å…³æ³¨æ„äº‹é¡¹ã€‚</p><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://docs.ansible.com/" target="_blank" rel="noopener">Ansible is an IT automation tool</a></p></article><hr><div><div class="post-metas mb-3"></div><p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨: <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…åè®®</a>ï¼Œè½¬è½½è¯·ä¿ç•™åŸæ–‡é“¾æ¥åŠä½œè€…ã€‚</p><div class="post-prevnext row"><div class="post-prev col-6"><a href="/post/451dc79a.html"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">mysqlåŸºç¡€çŸ¥è¯†</span> <span class="visible-mobile">ä¸Šä¸€ç¯‡</span></a></div><div class="post-next col-6"><a href="/post/d0c3803f.html"><span class="hidden-mobile">kubernetes å®‰è£…</span> <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span> <i class="iconfont icon-arrowright"></i></a></div></div></div><div class="comments" id="comments"><div id="vcomments"></div><script defer src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="/js/Valine.min.js"></script><script type="text/javascript">var notify=!1,verify=!1,oldLoadVa=window.onload;window.onload=function(){oldLoadVa&&oldLoadVa(),new Valine({lang:"zh-cn",el:"#vcomments",notify:notify,verify:verify,app_id:"dXhxgFWthuLPDnYYuAJbIe6X-MdYXbMMI",app_key:"In8P9esI1pt8dBUc7JbFCvLa",placeholder:"è¯´ç‚¹ä»€ä¹ˆ",avatar:"/retro",meta:["nick","mail","link"],pageSize:"10",emoticon_url:"/emoji",emoticon_list:["åŠ¨è€³æœµ.gif","æŠ–è„šè„š.gif","æŠ–çœ¼.gif","æŠ–çœ¼é•œ.gif","é£å¹ç§€å‘.gif","æ…Œå¼ .gif","å¤¹ä½.gif","å¼€è½¦.gif","å“­å”§å”§.gif","ç»¿è‰²çš„.gif","è·³èˆ.gif","è·³ç€èµ°.gif","å°èŠ±èŠ±.gif","çœ¼ç›è½¬.gif","æ‘‡å¤´.gif","çœ¨çœ¼.gif","åƒä¸œè¥¿.gif","å¼¹è‚šçš®.gif","åŠ¨æ¬¡æ‰“æ¬¡.gif","æ¯”å¿ƒå¿ƒ.gif","å¹é£.gif","æ‰“ç¯®çƒ.gif","éƒ½æ˜¯å°å¿ƒå¿ƒ.gif","å.png","å–·è¡€.png","ç‹‚æ±—.png","ä¸è¯´è¯.png","æ±—.png","åç­‰.png","çŒ®èŠ±.png","ä¸é«˜å…´.png","ä¸­åˆ€.png","å®³ç¾.png","çš±çœ‰.png","å°çœ¼ç›.png","ä¸­æŒ‡.png","å°´å°¬.png","ç…ä½ .png","æƒ³ä¸€æƒ³.png","ä¸­æª.png","å¾—æ„.png","è‚¿åŒ….png","æ‰‡è€³å…‰.png","äº²äº².png","æƒŠå–œ.png","è„¸çº¢.png","æ— æ‰€è°“.png","ä¾¿ä¾¿.png","æ„¤æ€’.png","èœ¡çƒ›.png","çŒ®é»„ç“œ.png","å†…ä¼¤.png","æŠ•é™.png","è§‚å¯Ÿ.png","çœ‹ä¸è§.png","å‡»æŒ.png","æŠ é¼».png","é‚ªæ¶.png","çœ‹çƒ­é—¹.png","å£æ°´.png","æŠ½çƒŸ.png","é”çœ‰.png","è£…å¤§æ¬¾.png","åèˆŒ.png","æ— å¥ˆ.png","é•¿è‰.png","èµä¸€ä¸ª.png","å‘²ç‰™.png","æ— è¯­.png","é˜´æš—.png","ä¸å‡ºæ‰€æ–™.png","å’½æ°”.png","æœŸå¾….png","é«˜å…´.png","åè¡€å€’åœ°.png","å“­æ³£.png","æ¬¢å‘¼.png","é»‘çº¿.png","å–œæè€Œæ³£.png","å–·æ°´.png","æ·±æ€.png","é¼“æŒ.png","æš—åœ°è§‚å¯Ÿ.png"]})}</script></div></div></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p><div id="tocbot"></div></div></div></div></div><div class="col-lg-7 mx-auto nopadding-md"><div class="container custom post-content mx-auto"><img src="/images/wechatpay.webp" class="rounded mx-auto d-block mt-5" style="width:120px;height:150px;vertical-align:-webkit-baseline-middle"><br><div style="text-align:center">ä¹°ä¸ªå¤è›‹ï¼Œåƒæ ¹å†°æ£’</div></div></div></main><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><footer class="mt-5"><div class="text-center py-3"><div><svg t="1586793095516" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3553" width="16" height="16"><path d="M512 0c282.7776 0 512 229.2224 512 512s-229.2224 512-512 512S0 794.7776 0 512 229.2224 0 512 0z m0 71.424a440.576 440.576 0 1 0 0 881.152 440.576 440.576 0 0 0 0-881.152z m8.192 166.7072c55.296 0 108.3904 15.5136 153.7536 44.2368a35.7376 35.7376 0 0 1-38.144 60.3648 215.6032 215.6032 0 0 0-115.5584-33.1264c-116.6336 0-210.6368 90.88-210.6368 202.3936s94.0032 202.3936 210.6368 202.3936c41.0112 0 80.2304-11.264 113.8688-32.1024a35.7376 35.7376 0 0 1 37.632 60.7744 287.1296 287.1296 0 0 1-151.552 42.8032c-155.4944 0-282.0608-122.368-282.0608-273.8688 0-151.552 126.5664-273.8688 282.112-273.8688z" fill="#8a8a8a" p-id="3554"></path></svg> <span itemprop="copyrightYear" id="cori">2021</span><br><svg t="1584375698087" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1913" width="23" height="14"><path d="M513.984496 513.984496c141.383442 0 256-114.616558 256-256S655.367938 1.984496 513.984496 1.984496 257.984496 116.601054 257.984496 257.984496s114.616558 256 256 256z m0-59.534884c-108.50431 0-196.465116-87.960806-196.465116-196.465116s87.960806-196.465116 196.465116-196.465116 196.465116 87.960806 196.465116 196.465116-87.960806 196.465116-196.465116 196.465116z" fill="#8a8a8a" p-id="1914"></path><path d="M1020.031008 992.248062c0-281.647628-227.423256-510.015504-508.031008-510.015504S3.968992 710.600434 3.968992 992.248062a29.767442 29.767442 0 1 0 59.534884 0c0-248.820093 200.827039-450.48062 448.496124-450.48062s448.496124 201.660527 448.496124 450.48062a29.767442 29.767442 0 1 0 59.534884 0z" fill="#8a8a8a" p-id="1915"></path></svg> <span class="author" id="cori" itemprop="copyrightHolder">Bryce Huang</span></div></div><script type="text/javascript" src="/js/commentTyping.min.js"></script></footer><script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script><script src="/js/main.js"></script><script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script><script>$(document).ready(function(){var t=$("#board-ctn").offset().top;tocbot.init({tocSelector:"#tocbot",contentSelector:".post-content",headingSelector:"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:6,scrollSmooth:!0,headingsOffset:-t}),0<$(".toc-list-item").length&&$("#toc").css("visibility","visible")})</script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script src="/js/clipboard-use.js"></script><script src="/js/custom.js"></script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>var typed=new Typed("#subtitle",{strings:["  ","Ansibleç®€æ˜æŒ‡åŒ—&nbsp;"],cursorChar:"_",typeSpeed:70,loop:!1});typed.stop(),$(document).ready(function(){$(".typed-cursor").addClass("h2"),typed.start()})</script><script src="/js/local-search.js"></script><script>var path="/local-search.xml",inputArea=document.querySelector("#local-search-input");inputArea.onclick=function(){searchFunc(path,"local-search-input","local-search-result"),this.onclick=null}</script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><script>$("#post img:not(.no-zoom img, img[no-zoom]), img[zoom]").each(function(){var t=document.createElement("a");$(t).attr("data-fancybox","images"),$(t).attr("href",$(this).attr("src")),$(this).wrap(t)})</script></body></html>