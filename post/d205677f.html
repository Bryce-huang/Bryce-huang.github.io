<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/blog/crown.png"><link rel="icon" type="image/png" href="/img/blog/crown.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#2f4154"><meta name="description" content="Nothing is so common as the wish to be remarkables"><meta name="author" content="Bryce Huang"><meta name="keywords" content="blog,program,life"><title>使用jib代替docker-maven构建镜像 - Bryce&#39;s Club</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/dracula.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_fmb4a04yx8h.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css"><link rel="stylesheet" href="https://cdn.staticfile.org/gitalk/1.6.2/gitalk.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Bryce's Club" type="application/atom+xml"></head><body><div id="dark" onclick="switchDarkMode()"></div><script>var isNight=18<=(new Date).getHours()||(new Date).getHours()<8;(matchMedia("(prefers-color-scheme: dark)").matches||isNight||"1"===localStorage.getItem("dark"))&&(isNight&&"1"===localStorage.getItem("noDark")||document.body.classList.add("dark")),document.getElementById("dark").innerHTML=document.querySelector("body").classList.contains("dark")?"🌙":"🌞"</script><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>Bryce's Club</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item"><a class="nav-link" href="/messageboard/"><i class="iconfont icon-speakernotes"></i> 留言</a></li><li class="nav-item"><a class="nav-link" href="/features/"><i class="iconfont icon-exp-fill"></i> 功能</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i class="iconfont icon-search"></i>&nbsp;&nbsp;</a></li></ul></div></div></nav><div class="view intro-2" id="background" parallax="true" style="background:url(/img/star-guardian/champion-pajama-group-splash.webp) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="container text-center white-text fadeInUp"><span class="h2" id="subtitle"></span><div class="mt-3 post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2020-11-20 18:18">星期五, 十一月 20日 2020, 6:18 晚上</time></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 1.8k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 32 分钟</span></div></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5" id="board"><div class="post-content mx-auto" id="post"><article class="markdown-body"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>jib是google开源的纯java实现的容器构建类库，其中有jib-core核心包和maven以及gradle插件，jib可以帮助java开发者,快速构建镜像，并且无需编写dockerfile以及依赖docker环境（docker daemon和docker client），这里只介绍jib-maven-plugin如何使用，并且会讲到其中的坑点，至于核心包，我这边就不讲了，虽然笔者也有使用。详细可以到GitHub搜索jib</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>在maven项目中的<code>pom.xml</code>文件中：</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span>
  ...
  <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
      ...
      <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.cloud.tools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jib-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">to</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">image</span>&gt;</span>myimage<span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">to</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
      ...
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
  ...
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span></code></pre></div><p>其中插件configuration支持的参数列表如下：</p><table><thead><tr><th>Field</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>to</code></td><td><a href="#to-object"><code>to</code></a></td><td><em>Required</em></td><td>Configures the target image to build your application to.</td></tr><tr><td><code>from</code></td><td><a href="#from-object"><code>from</code></a></td><td>See <a href="#from-object"><code>from</code></a></td><td>Configures the base image to build your application on top of.</td></tr><tr><td><code>container</code></td><td><a href="#container-object"><code>container</code></a></td><td>See <a href="#container-object"><code>container</code></a></td><td>Configures the container that is run from your image.</td></tr><tr><td><code>extraDirectories</code></td><td><a href="#extradirectories-object"><code>extraDirectories</code></a></td><td>See <a href="#extradirectories-object"><code>extraDirectories</code></a></td><td>Configures the directories used to add arbitrary files to the image.</td></tr><tr><td><code>outputPaths</code></td><td><a href="#outputpaths-object"><code>outputPaths</code></a></td><td>See <a href="#outputpaths-object"><code>outputPaths</code></a></td><td>Configures the locations of additional build artifacts generated by Jib.</td></tr><tr><td><code>dockerClient</code></td><td><a href="#dockerclient-object"><code>dockerClient</code></a></td><td>See <a href="#dockerclient-object"><code>dockerClient</code></a></td><td>Configures Docker for building to/from the Docker daemon.</td></tr><tr><td><code>skaffold</code></td><td><a href="#skaffold-integration"><code>skaffold</code></a></td><td>See <a href="#skaffold-integration"><code>skaffold</code></a></td><td>Configures the internal skaffold goals. This configuration should only be used when integrating with <a href="#skaffold-integration"><code>skaffold</code></a>.</td><td></td></tr><tr><td><code>containerizingMode</code></td><td>string</td><td><code>exploded</code></td><td>If set to <code>packaged</code>, puts the JAR artifact built at <code>${project.build.directory}/${project.build.finalName}.jar</code> (the default location where many JAR-buidiling plugins put a JAR registered as a main artifact, such as the Maven JAR Plugin) into the final image. If set to <code>exploded</code> (default), containerizes individual <code>.class</code> files and resources files.</td></tr><tr><td><code>allowInsecureRegistries</code></td><td>boolean</td><td><code>false</code></td><td>If set to true, Jib ignores HTTPS certificate errors and may fall back to HTTP as a last resort. Leaving this parameter set to <code>false</code> is strongly recommended, since HTTP communication is unencrypted and visible to others on the network, and insecure HTTPS is no better than plain HTTP. <a href="https://github.com/GoogleContainerTools/jib/tree/master/docs/self_sign_cert.md" target="_blank" rel="noopener">If accessing a registry with a self-signed certificate, adding the certificate to your Java runtime’s trusted keys</a> may be an alternative to enabling this option.</td></tr><tr><td><code>skip</code></td><td>boolean</td><td><code>false</code></td><td>If set to true, Jib execution is skipped (useful for multi-module projects). This can also be specified via the <code>-Djib.skip</code> command line option.</td></tr></tbody></table><p><code>from</code> 参数</p><table><thead><tr><th>Property</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>image</code></td><td>string</td><td><code>gcr.io/distroless/java</code></td><td>The image reference for the base image. The source type can be specified using a <a href="#setting-the-base-image">special type prefix</a>.</td></tr><tr><td><code>auth</code></td><td><a href="#auth-object"><code>auth</code></a></td><td><em>None</em></td><td>Specifies credentials directly (alternative to <code>credHelper</code>).</td></tr><tr><td><code>credHelper</code></td><td>string</td><td><em>None</em></td><td>Specifies a credential helper that can authenticate pulling the base image. This parameter can either be configured as an absolute path to the credential helper executable or as a credential helper suffix (following <code>docker-credential-</code>).</td></tr><tr><td><code>platforms</code></td><td>list</td><td>See <a href="#platform-object"><code>platform</code></a></td><td><em>Incubating feature</em>: Configures platforms of base images to select from a manifest list.</td></tr></tbody></table><p><code>to</code>标签配置</p><table><thead><tr><th>Property</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>image</code></td><td>string</td><td><em>Required</em></td><td>The image reference for the target image. This can also be specified via the <code>-Dimage</code> command line option.</td></tr><tr><td><code>auth</code></td><td><a href="#auth-object"><code>auth</code></a></td><td><em>None</em></td><td>Specifies credentials directly (alternative to <code>credHelper</code>).</td></tr><tr><td><code>credHelper</code></td><td>string</td><td><em>None</em></td><td>Specifies a credential helper that can authenticate pushing the target image. This parameter can either be configured as an absolute path to the credential helper executable or as a credential helper suffix (following <code>docker-credential-</code>).</td></tr><tr><td><code>tags</code></td><td>list</td><td><em>None</em></td><td>Additional tags to push to.</td></tr></tbody></table><p><code>auth</code>标签配置</p><table><thead><tr><th>Property</th><th>Type</th></tr></thead><tbody><tr><td><code>username</code></td><td>string</td></tr><tr><td><code>password</code></td><td>string</td></tr></tbody></table><p><code>platform</code> 标签配置</p><table><thead><tr><th>Property</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>architecture</code></td><td>string</td><td><code>amd64</code></td><td>The architecture of a base image to select from a manifest list.</td></tr><tr><td><code>os</code></td><td>string</td><td><code>linux</code></td><td>The OS of a base image to select from a manifest list.</td></tr></tbody></table><p><code>container</code>标签配置</p><table><thead><tr><th>Property</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>appRoot</code></td><td>string</td><td><code>/app</code></td><td>The root directory on the container where the app’s contents are placed. Particularly useful for WAR-packaging projects to work with different Servlet engine base images by designating where to put exploded WAR contents; see <a href="#war-projects">WAR usage</a> as an example.</td></tr><tr><td><code>args</code></td><td>list</td><td><em>None</em></td><td>Additional program arguments appended to the command to start the container (similar to Docker’s <a href="https://docs.docker.com/engine/reference/builder/#cmd" target="_blank" rel="noopener">CMD</a> instruction in relation with <a href="https://docs.docker.com/engine/reference/builder/#entrypoint" target="_blank" rel="noopener">ENTRYPOINT</a>). In the default case where you do not set a custom <code>entrypoint</code>, this parameter is effectively the arguments to the main method of your Java application.</td></tr><tr><td><code>creationTime</code></td><td>string</td><td><code>EPOCH</code></td><td>Sets the container creation time. (Note that this property does not affect the file modification times, which are configured using <code>&lt;filesModificationTime&gt;</code>.) The value can be <code>EPOCH</code> to set the timestamps to Epoch (default behavior), <code>USE_CURRENT_TIMESTAMP</code> to forgo reproducibility and use the real creation time, or an ISO 8601 date-time parsable with <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/format/DateTimeFormatter.html#ISO_DATE_TIME" target="_blank" rel="noopener"><code>DateTimeFormatter.ISO_DATE_TIME</code></a> such as <code>2019-07-15T10:15:30+09:00</code> or <code>2011-12-03T22:42:05Z</code>.</td></tr><tr><td><code>entrypoint</code></td><td>list</td><td><em>None</em></td><td>The command to start the container with (similar to Docker’s <a href="https://docs.docker.com/engine/reference/builder/#entrypoint" target="_blank" rel="noopener">ENTRYPOINT</a> instruction). If set, then <code>jvmFlags</code> and <code>mainClass</code> are ignored. You may also set <code>&lt;entrypoint&gt;INHERIT&lt;/entrypoint&gt;</code> (<code>&lt;entrypoint&gt;&lt;entry&gt;INHERIT&lt;/entry&gt;&lt;/entrypoint&gt;</code> in old Maven versions) to indicate that the <code>entrypoint</code> and <code>args</code> should be inherited from the base image.*</td></tr><tr><td><code>environment</code></td><td>map</td><td><em>None</em></td><td>Key-value pairs for setting environment variables on the container (similar to Docker’s <a href="https://docs.docker.com/engine/reference/builder/#env" target="_blank" rel="noopener">ENV</a> instruction).</td></tr><tr><td><code>extraClasspath</code></td><td>list</td><td><em>None</em></td><td>Additional paths in the container to prepend to the computed Java classpath.</td></tr><tr><td><code>filesModificationTime</code></td><td>string</td><td><code>EPOCH_PLUS_SECOND</code></td><td>Sets the modification time (last modified time) of files in the image put by Jib. (Note that this does not set the image creation time, which can be set using <code>&lt;creationTime&gt;</code>.) The value should either be <code>EPOCH_PLUS_SECOND</code> to set the timestamps to Epoch + 1 second (default behavior), or an ISO 8601 date-time parsable with <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/format/DateTimeFormatter.html#ISO_DATE_TIME" target="_blank" rel="noopener"><code>DateTimeFormatter.ISO_DATE_TIME</code></a> such as <code>2019-07-15T10:15:30+09:00</code> or <code>2011-12-03T22:42:05Z</code>.</td></tr><tr><td><code>format</code></td><td>string</td><td><code>Docker</code></td><td>Use <code>OCI</code> to build an <a href="https://www.opencontainers.org/" target="_blank" rel="noopener">OCI container image</a>.</td></tr><tr><td><code>jvmFlags</code></td><td>list</td><td><em>None</em></td><td>Additional flags to pass into the JVM when running your application.</td></tr><tr><td><code>labels</code></td><td>map</td><td><em>None</em></td><td>Key-value pairs for applying image metadata (similar to Docker’s <a href="https://docs.docker.com/engine/reference/builder/#label" target="_blank" rel="noopener">LABEL</a> instruction).</td></tr><tr><td><code>mainClass</code></td><td>string</td><td><em>Inferred</em>**</td><td>The main class to launch the application from.</td></tr><tr><td><code>ports</code></td><td>list</td><td><em>None</em></td><td>Ports that the container exposes at runtime (similar to Docker’s <a href="https://docs.docker.com/engine/reference/builder/#expose" target="_blank" rel="noopener">EXPOSE</a> instruction).</td></tr><tr><td><code>user</code></td><td>string</td><td><em>None</em></td><td>The user and group to run the container as. The value can be a username or UID along with an optional groupname or GID. The following are all valid: <code>user</code>, <code>uid</code>, <code>user:group</code>, <code>uid:gid</code>, <code>uid:group</code>, <code>user:gid</code>.</td></tr><tr><td><code>volumes</code></td><td>list</td><td><em>None</em></td><td>Specifies a list of mount points on the container.</td></tr><tr><td><code>workingDirectory</code></td><td>string</td><td><em>None</em></td><td>The working directory in the container</td></tr></tbody></table><p><code>extraDirectories</code> 标签配置</p><table><thead><tr><th>Property</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>paths</code></td><td>list</td><td><code>[(project-dir)/src/main/jib]</code></td><td>List of <a href="#path-object"><code>path</code></a> objects and/or extra directory paths. Can be absolute or relative to the project root.</td></tr><tr><td><code>permissions</code></td><td>list</td><td><em>None</em></td><td>Maps file paths (glob patterns) on container to Unix permissions. (Effective only for files added from extra directories.) If not configured, permissions default to “755” for directories and “644” for files. See <a href="#adding-arbitrary-files-to-the-image">Adding Arbitrary Files to the Image</a> for an example.</td></tr></tbody></table><h4 id="系统构建参数"><a href="#系统构建参数" class="headerlink" title="系统构建参数"></a>系统构建参数</h4><p>(i.e. <code>-Djib.parameterName[.nestedParameter.[...]]=value</code>). Some examples are below:<br></p><div class="hljs"><pre><code class="hljs shell">mvn compile jib:build \
    -Djib.to.image=myregistry/myimage:latest \
    -Djib.to.auth.username=$USERNAME \
    -Djib.to.auth.password=$PASSWORD

mvn compile jib:dockerBuild \
    -Djib.dockerClient.executable=/path/to/docker \
    -Djib.container.environment=key1="value1",key2="value2" \
    -Djib.container.args=arg1,arg2,arg3</code></pre></div><p></p><h2 id="maven完整使用案例"><a href="#maven完整使用案例" class="headerlink" title="maven完整使用案例"></a>maven完整使用案例</h2><p>目录结构<br>.<br>├── hello-world<br>├── jib-lib<br>├── name<br>└── pom.xml</p><p>这是一个多模块工程，其中<code>jib-lib</code>为基础依赖模块，hello-world和name都是web模块</p><p>父<code>pom.xml</code>配置如下：</p><div class="hljs"><pre><code class="hljs xml"> <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">maven.build.timestamp.format</span>&gt;</span>yyyyMMdd-HHmmssSSS<span class="hljs-tag">&lt;/<span class="hljs-name">maven.build.timestamp.format</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Defines plugins that are used in the modules. --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">pluginManagement</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.cloud.tools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jib-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">pluginManagement</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span></code></pre></div><p>hello-world</p><div class="hljs"><pre><code class="hljs xml">  <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.cloud.tools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jib-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">allowInsecureRegistries</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">allowInsecureRegistries</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">from</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">image</span>&gt;</span>localhost:5000/jre:11<span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">auth</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>$&#123;env.DOCKERUSER&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>$&#123;env.DOCKERPW&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">auth</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">from</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">to</span>&gt;</span>
          <span class="hljs-comment">&lt;!-- make sure you already have created a project at Google Cloud Platform, see https://cloud.google.com/container-registry/ --&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">image</span>&gt;</span>localhost:5000/$&#123;project.artifactId&#125;:$&#123;project.version&#125;-$&#123;maven.build.timestamp&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span>

      <span class="hljs-tag">&lt;/<span class="hljs-name">to</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">container</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 使用当前时间构建,否则50年前的时间，可以查看：https://github.com/GoogleContainerTools/jib/blob/master/docs/faq.md#why-is-my-image-created-48-years-ago --&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">creationTime</span>&gt;</span>USE_CURRENT_TIMESTAMP<span class="hljs-tag">&lt;/<span class="hljs-name">creationTime</span>&gt;</span> 
          
          <span class="hljs-tag">&lt;<span class="hljs-name">jvmFlags</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">jvmFlag</span>&gt;</span>-Xms256m<span class="hljs-tag">&lt;/<span class="hljs-name">jvmFlag</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">jvmFlag</span>&gt;</span>-Xmx512m<span class="hljs-tag">&lt;/<span class="hljs-name">jvmFlag</span>&gt;</span>

          <span class="hljs-tag">&lt;/<span class="hljs-name">jvmFlags</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>com.example.helloworld.HelloWorldApplication<span class="hljs-tag">&lt;/<span class="hljs-name">mainClass</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">ports</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">port</span>&gt;</span>8080<span class="hljs-tag">&lt;/<span class="hljs-name">port</span>&gt;</span>
              <span class="hljs-comment">&lt;!-- &lt;port&gt;4000-4004/udp&lt;/port&gt; --&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">ports</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">format</span>&gt;</span>OCI<span class="hljs-tag">&lt;/<span class="hljs-name">format</span>&gt;</span>
          <span class="hljs-comment">&lt;!-- OR &lt;format&gt;Docker&lt;/format&gt; --&gt;</span>

      <span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></code></pre></div><p>依赖库<code>pom.xml</code>配置：</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.cloud.tools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jib-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- we don't want jib to execute on this module --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">skip</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">skip</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></code></pre></div><p>构建命令：</p><div class="hljs"><pre><code class="hljs bash"><span class="hljs-comment">#构建全部</span>
mvn clean package jib:build -Dmaven.test.skip=<span class="hljs-literal">true</span> -DsendCredentialsOverHttp=<span class="hljs-literal">true</span>
<span class="hljs-comment">#构建某个模块</span>

mvn clean package jib:build -pl hello-world -am -Dmaven.test.skip=<span class="hljs-literal">true</span> -DsendCredentialsOverHttp=<span class="hljs-literal">true</span></code></pre></div><p>这里重点说一下<code>-DsendCredentialsOverHttp=true</code> 这个参数将允许你使用http发送账号密码，google都喜欢强迫用户使用https.</p><p>PS: <code>jvmFlag</code>用来配置jvm参数，<code>mainClass</code> 配置运行类 ，构建镜像最后文件否会放到 <code>/app</code> 目录下，该目录下拥有三个目录分别是： <code>classes</code> <code>libs</code> <code>resources</code> 源码字节码，依赖包和配置文件</p><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="https://github.com/GoogleContainerTools/jib" target="_blank" rel="noopener">jib源码</a></p><p><a href="https://github.com/GoogleContainerTools/jib/blob/master/docs/faq.md" target="_blank" rel="noopener">jib FAQ</a></p></article><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/java/">java</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/image/">image</a> <a class="hover-with-bg" href="/tags/%E5%AE%B9%E5%99%A8/">容器</a> <a class="hover-with-bg" href="/tags/jib/">jib</a></div></div><p class="note note-warning">本博客所有文章除特别声明外，均采用: <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际协议</a>，转载请保留原文链接及作者。</p><div class="post-prevnext row"><div class="post-prev col-6"><a href="/post/f59de2d9.html"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">我对理财的思考</span> <span class="visible-mobile">上一篇</span></a></div><div class="post-next col-6"><a href="/post/153c5116.html"><span class="hidden-mobile">使用Java操作k8s和registry</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></div></div></div><div class="comments" id="comments"><div id="vcomments"></div><script defer src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="/js/Valine.min.js"></script><script type="text/javascript">var notify=!1,verify=!1,oldLoadVa=window.onload;window.onload=function(){oldLoadVa&&oldLoadVa(),new Valine({lang:"zh-cn",el:"#vcomments",notify:notify,verify:verify,app_id:"dXhxgFWthuLPDnYYuAJbIe6X-MdYXbMMI",app_key:"In8P9esI1pt8dBUc7JbFCvLa",placeholder:"说点什么",avatar:"/retro",meta:["nick","mail","link"],pageSize:"10",emoticon_url:"/emoji",emoticon_list:["动耳朵.gif","抖脚脚.gif","抖眼.gif","抖眼镜.gif","风吹秀发.gif","慌张.gif","夹住.gif","开车.gif","哭唧唧.gif","绿色的.gif","跳舞.gif","跳着走.gif","小花花.gif","眼睛转.gif","摇头.gif","眨眼.gif","吃东西.gif","弹肚皮.gif","动次打次.gif","比心心.gif","吹风.gif","打篮球.gif","都是小心心.gif","吐.png","喷血.png","狂汗.png","不说话.png","汗.png","坐等.png","献花.png","不高兴.png","中刀.png","害羞.png","皱眉.png","小眼睛.png","中指.png","尴尬.png","瞅你.png","想一想.png","中枪.png","得意.png","肿包.png","扇耳光.png","亲亲.png","惊喜.png","脸红.png","无所谓.png","便便.png","愤怒.png","蜡烛.png","献黄瓜.png","内伤.png","投降.png","观察.png","看不见.png","击掌.png","抠鼻.png","邪恶.png","看热闹.png","口水.png","抽烟.png","锁眉.png","装大款.png","吐舌.png","无奈.png","长草.png","赞一个.png","呲牙.png","无语.png","阴暗.png","不出所料.png","咽气.png","期待.png","高兴.png","吐血倒地.png","哭泣.png","欢呼.png","黑线.png","喜极而泣.png","喷水.png","深思.png","鼓掌.png","暗地观察.png"]})}</script></div></div></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div id="tocbot"></div></div></div></div></div><div class="col-lg-7 mx-auto nopadding-md"><div class="container custom post-content mx-auto"><img src="/images/wechatpay.webp" class="rounded mx-auto d-block mt-5" style="width:120px;height:150px;vertical-align:-webkit-baseline-middle"><br><div style="text-align:center">买个卤蛋，吃根冰棒</div></div></div></main><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><footer class="mt-5"><div class="text-center py-3"><div><svg t="1586793095516" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3553" width="16" height="16"><path d="M512 0c282.7776 0 512 229.2224 512 512s-229.2224 512-512 512S0 794.7776 0 512 229.2224 0 512 0z m0 71.424a440.576 440.576 0 1 0 0 881.152 440.576 440.576 0 0 0 0-881.152z m8.192 166.7072c55.296 0 108.3904 15.5136 153.7536 44.2368a35.7376 35.7376 0 0 1-38.144 60.3648 215.6032 215.6032 0 0 0-115.5584-33.1264c-116.6336 0-210.6368 90.88-210.6368 202.3936s94.0032 202.3936 210.6368 202.3936c41.0112 0 80.2304-11.264 113.8688-32.1024a35.7376 35.7376 0 0 1 37.632 60.7744 287.1296 287.1296 0 0 1-151.552 42.8032c-155.4944 0-282.0608-122.368-282.0608-273.8688 0-151.552 126.5664-273.8688 282.112-273.8688z" fill="#8a8a8a" p-id="3554"></path></svg> <span itemprop="copyrightYear" id="cori">2021</span><br><svg t="1584375698087" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1913" width="23" height="14"><path d="M513.984496 513.984496c141.383442 0 256-114.616558 256-256S655.367938 1.984496 513.984496 1.984496 257.984496 116.601054 257.984496 257.984496s114.616558 256 256 256z m0-59.534884c-108.50431 0-196.465116-87.960806-196.465116-196.465116s87.960806-196.465116 196.465116-196.465116 196.465116 87.960806 196.465116 196.465116-87.960806 196.465116-196.465116 196.465116z" fill="#8a8a8a" p-id="1914"></path><path d="M1020.031008 992.248062c0-281.647628-227.423256-510.015504-508.031008-510.015504S3.968992 710.600434 3.968992 992.248062a29.767442 29.767442 0 1 0 59.534884 0c0-248.820093 200.827039-450.48062 448.496124-450.48062s448.496124 201.660527 448.496124 450.48062a29.767442 29.767442 0 1 0 59.534884 0z" fill="#8a8a8a" p-id="1915"></path></svg> <span class="author" id="cori" itemprop="copyrightHolder">Bryce Huang</span></div></div><script type="text/javascript" src="/js/commentTyping.min.js"></script></footer><script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script><script src="/js/main.js"></script><script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script><script>$(document).ready(function(){var t=$("#board-ctn").offset().top;tocbot.init({tocSelector:"#tocbot",contentSelector:".post-content",headingSelector:"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:6,scrollSmooth:!0,headingsOffset:-t}),0<$(".toc-list-item").length&&$("#toc").css("visibility","visible")})</script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script src="/js/clipboard-use.js"></script><script src="/js/custom.js"></script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>var typed=new Typed("#subtitle",{strings:["  ","使用jib代替docker-maven构建镜像&nbsp;"],cursorChar:"_",typeSpeed:70,loop:!1});typed.stop(),$(document).ready(function(){$(".typed-cursor").addClass("h2"),typed.start()})</script><script src="/js/local-search.js"></script><script>var path="/local-search.xml",inputArea=document.querySelector("#local-search-input");inputArea.onclick=function(){searchFunc(path,"local-search-input","local-search-result"),this.onclick=null}</script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><script>$("#post img:not(.no-zoom img, img[no-zoom]), img[zoom]").each(function(){var t=document.createElement("a");$(t).attr("data-fancybox","images"),$(t).attr("href",$(this).attr("src")),$(this).wrap(t)})</script></body></html>